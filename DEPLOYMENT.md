# üöÄ AGV Gold Loan Management - Deployment Guide

Complete guide to deploy your application to **Railway** (Backend + Database), **Vercel** (Frontend), and **Cloudinary** (File Storage).

---

## üìã Prerequisites

- GitHub account
- Railway account (sign up at https://railway.app)
- Vercel account (sign up at https://vercel.com)
- Cloudinary account (sign up at https://cloudinary.com)

---

## ‚òÅÔ∏è STEP 1: Set Up Cloudinary (File Storage)

### 1.1 Create Cloudinary Account

1. Go to https://cloudinary.com/users/register/free
2. Sign up for a free account
3. Verify your email

### 1.2 Get Your Credentials

1. Log in to https://cloudinary.com/console
2. On your Dashboard, find:
   - **Cloud Name**
   - **API Key**
   - **API Secret**
3. **Keep these safe** - you'll need them later!

### 1.3 Create Folder Structure (Optional)

1. Go to **Media Library** in Cloudinary
2. Create folders:
   ```
   agv-loans/
   ‚îú‚îÄ‚îÄ documents/
   ‚îú‚îÄ‚îÄ gold-items/
   ‚îî‚îÄ‚îÄ profiles/
   ```

---

## üöÇ STEP 2: Deploy Backend to Railway

### 2.1 Create Railway Project

1. Go to https://railway.app
2. Click **"Login"** and sign in with GitHub
3. Click **"New Project"**
4. Select **"Deploy from GitHub repo"**
5. Choose your **`agv-gold-lendr`** repository
6. Railway will detect it as a Node.js project

### 2.2 Add PostgreSQL Database

1. In your Railway project, click **"New"**
2. Select **"Database"** ‚Üí **"PostgreSQL"**
3. Railway will create a database and provide `DATABASE_URL`
4. **Note**: This DATABASE_URL is automatically injected into your backend

### 2.3 Configure Environment Variables

1. Click on your **backend service**
2. Go to **"Variables"** tab
3. Add the following variables:

```bash
# Automatically provided by Railway
DATABASE_URL=(auto-generated by Railway PostgreSQL)

# Required - Set these manually
NODE_ENV=production
PORT=3000
JWT_SECRET=your-super-secret-jwt-key-change-this-2024
CORS_ORIGIN=https://your-app-name.vercel.app

# Cloudinary (from Step 1)
CLOUDINARY_CLOUD_NAME=your-cloud-name
CLOUDINARY_API_KEY=your-api-key
CLOUDINARY_API_SECRET=your-api-secret

# Optional
BCRYPT_ROUNDS=12
JWT_EXPIRES_IN=24h
```

### 2.4 Configure Build Settings

1. Go to **"Settings"** ‚Üí **"Build"**
2. Set **Root Directory**: `backend`
3. Set **Build Command**: `npm install && npm run build`
4. Set **Start Command**: `npm run start`
5. Click **"Save Changes"**

### 2.5 Deploy

1. Railway will automatically deploy
2. Wait for deployment to complete (check **"Deployments"** tab)
3. Once deployed, click **"Generate Domain"** to get your backend URL
4. **Save this URL** - Example: `https://agv-gold-lendr-production.up.railway.app`

### 2.6 Verify Deployment

1. Visit your Railway URL: `https://your-backend.up.railway.app/health`
2. You should see: `{"status":"ok","timestamp":"..."}`
3. ‚úÖ Backend is live!

---

## ‚ñ≤ STEP 3: Deploy Frontend to Vercel

### 3.1 Create .env.production

1. In your project root, create `.env.production`:

```bash
VITE_API_URL=https://your-backend.up.railway.app/api
```

**Replace** `your-backend.up.railway.app` with your actual Railway URL from Step 2.5

### 3.2 Deploy to Vercel

#### Option A: Using Vercel Dashboard (Recommended)

1. Go to https://vercel.com
2. Click **"Add New"** ‚Üí **"Project"**
3. **Import Git Repository**:
   - Click **"Import"** on your `agv-gold-lendr` repo
4. **Configure Project**:
   - **Framework Preset**: Vite
   - **Root Directory**: `./` (leave as is)
   - **Build Command**: `npm run build`
   - **Output Directory**: `dist`
5. **Environment Variables**:
   - Add variable: `VITE_API_URL`
   - Value: `https://your-backend.up.railway.app/api`
6. Click **"Deploy"**
7. Wait 2-3 minutes for deployment
8. Your app will be live at: `https://your-app.vercel.app`

#### Option B: Using Vercel CLI

```bash
# Install Vercel CLI
npm install -g vercel

# Login
vercel login

# Deploy
cd d:\AVG_LOV\agv-gold-lendr
vercel

# Follow prompts:
# - Link to existing project? No
# - Project name: agv-gold-lendr
# - Directory: ./ (root)
# - Override settings? No

# After first deployment, set environment variable:
vercel env add VITE_API_URL production
# Enter: https://your-backend.up.railway.app/api

# Deploy to production
vercel --prod
```

### 3.3 Update CORS in Backend

1. Go back to **Railway**
2. Update `CORS_ORIGIN` environment variable:
   ```
   CORS_ORIGIN=https://your-app.vercel.app
   ```
3. Railway will automatically redeploy

---

## üîÑ STEP 4: Final Configuration

### 4.1 Test the Connection

1. Visit your Vercel URL: `https://your-app.vercel.app`
2. Try to login with test credentials
3. Check browser console for any errors
4. Upload a test file to verify Cloudinary integration

### 4.2 Seed Database (Optional)

If you want to add sample data:

```bash
# Connect to Railway PostgreSQL
# In Railway, go to PostgreSQL ‚Üí Connect ‚Üí Copy DATABASE_URL

# On your local machine:
cd backend
DATABASE_URL="your-railway-database-url" npx prisma db push
DATABASE_URL="your-railway-database-url" npm run db:seed
```

---

## üéØ STEP 5: Post-Deployment Checklist

### ‚úÖ Verify Everything Works

- [ ] Frontend loads at Vercel URL
- [ ] Backend API responds at Railway URL + `/health`
- [ ] Login works
- [ ] Customer creation works
- [ ] Loan creation works
- [ ] File upload works (Cloudinary)
- [ ] Dashboard shows data
- [ ] No CORS errors in browser console

### üîí Security Checklist

- [ ] Changed JWT_SECRET to a strong random string
- [ ] DATABASE_URL is secure (auto-handled by Railway)
- [ ] Cloudinary credentials are set correctly
- [ ] CORS_ORIGIN points to your Vercel domain
- [ ] No sensitive data in .env files committed to GitHub

---

## üìä Your Live URLs

After deployment, you'll have:

| Service | URL | Purpose |
|---------|-----|---------|
| **Frontend** | https://your-app.vercel.app | User Interface |
| **Backend API** | https://your-backend.up.railway.app/api | REST API |
| **Database** | (Private - Railway managed) | PostgreSQL |
| **File Storage** | https://res.cloudinary.com/your-cloud | Files & Images |

---

## üîß Troubleshooting

### Frontend can't connect to backend

**Problem**: CORS errors in browser console

**Solution**:
1. Check `CORS_ORIGIN` in Railway matches your Vercel URL
2. Ensure `VITE_API_URL` in Vercel points to Railway URL
3. Redeploy both services

### Database migrations not running

**Problem**: "Table does not exist" errors

**Solution**:
```bash
# Railway will run migrations automatically via:
# npm run build (which includes prisma migrate deploy)

# If still issues, manually run:
cd backend
DATABASE_URL="your-railway-url" npx prisma migrate deploy
```

### File uploads failing

**Problem**: 500 error when uploading files

**Solution**:
1. Verify Cloudinary credentials in Railway
2. Check Cloudinary console for API usage
3. Ensure file size limits are respected (3-5MB)

### Railway deployment failed

**Problem**: Build errors in Railway

**Solution**:
1. Check **"Deployments"** ‚Üí **"Logs"** for exact error
2. Common fixes:
   - Ensure `backend/package.json` has correct scripts
   - Verify all dependencies are in `package.json`
   - Check TypeScript compilation errors

---

## üîÑ Continuous Deployment

### Automatic Deployments

Both Railway and Vercel will automatically deploy when you push to GitHub:

```bash
# Make changes to your code
git add .
git commit -m "Your changes"
git push origin main

# Railway and Vercel will automatically:
# 1. Detect the push
# 2. Pull latest code
# 3. Build the project
# 4. Deploy to production
```

### Manual Redeploy

**Railway**:
1. Go to your project
2. Click **"Deployments"**
3. Click **"Redeploy"** on latest deployment

**Vercel**:
1. Go to your project
2. Click **"Deployments"**
3. Click **"¬∑¬∑¬∑"** ‚Üí **"Redeploy"**

---

## üí∞ Free Tier Limits

### Railway
- ‚úÖ $5/month credit (automatically applied)
- ‚úÖ 500MB PostgreSQL storage
- ‚ö†Ô∏è Sleeps after 30 days of no traffic (can wake up)

### Vercel
- ‚úÖ Unlimited deployments
- ‚úÖ 100GB bandwidth/month
- ‚úÖ Automatic HTTPS
- ‚úÖ Global CDN

### Cloudinary
- ‚úÖ 25GB storage
- ‚úÖ 25GB bandwidth/month
- ‚úÖ Unlimited transformations

**Total Cost**: $0/month for moderate usage! üéâ

---

## üìû Support & Resources

### Documentation
- Railway: https://docs.railway.app
- Vercel: https://vercel.com/docs
- Cloudinary: https://cloudinary.com/documentation
- Prisma: https://www.prisma.io/docs

### Community
- Railway Discord: https://discord.gg/railway
- Vercel Discord: https://discord.gg/vercel

---

## üéä Congratulations!

Your AGV Gold Loan Management System is now live and accessible worldwide!

**Next Steps**:
- Share the URL with users
- Monitor usage in Railway/Vercel dashboards
- Set up custom domain (optional)
- Add monitoring/analytics (optional)

---

**Deployed by**: AGV Team
**Last Updated**: October 20, 2025
